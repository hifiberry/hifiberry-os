#!/bin/bash
lsof -Fpc /dev/snd/pcmC?D?p | grep -v '^p' | sed 's/^c//'

for container in $(docker ps -q); do
  # Try to run the 'is-active' command
  if ! output=$(docker exec $container is-active 2>/dev/null); then
    # If 'is-active' command fails, run the fallback command
    # Adjusted to correctly filter the lsof output for device files
    fallback_output=$(docker exec $container sh -c "lsof | grep '/dev/snd/pcmC[0-9]D[0-9]p'" 2>/dev/null | awk '{print $2}' | grep -v '^$')

    # Check if there's any fallback output before echoing
    if [ -n "$fallback_output" ]; then
      echo "$fallback_output"
    fi
  else
    # Process 'is-active' output only if it's not empty
    if [ -n "$output" ]; then
      basename=$(basename "$output")
      # Ensure basename is not empty before echoing
      if [ -n "$basename" ]; then
        echo "$basename"
      fi
    fi
  fi
done
