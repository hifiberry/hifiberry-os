#!/usr/bin/make -f

%:
	dh $@

override_dh_auto_configure:
	# Clone squeezelite repository if not present
	@if [ ! -d "squeezelite" ]; then \
		echo "Cloning squeezelite repository..."; \
		git clone https://github.com/ralph-irving/squeezelite.git; \
		cd squeezelite && git checkout 72e1fd8abfa9b2f8e9636f033247526920878718; \
	fi

override_dh_auto_build:
	# Build squeezelite
	cd squeezelite && $(MAKE)

override_dh_auto_install:
	# Install squeezelite binary
	mkdir -p debian/hifiberry-squeezelite/usr/bin
	mkdir -p debian/hifiberry-squeezelite/lib/systemd/system
	mkdir -p debian/hifiberry-squeezelite/var/lib/squeezelite
	mkdir -p debian/hifiberry-squeezelite/usr/share/man/man1
	
	# Copy squeezelite binary
	cp squeezelite/squeezelite debian/hifiberry-squeezelite/usr/bin/
	
	# Copy start script
	cp start-squeezelite debian/hifiberry-squeezelite/usr/bin/
	chmod +x debian/hifiberry-squeezelite/usr/bin/start-squeezelite
	
	# Install systemd service
	cp squeezelite.service debian/hifiberry-squeezelite/lib/systemd/system/
	
	# Install manual pages
	cp man/squeezelite.1 debian/hifiberry-squeezelite/usr/share/man/man1/
	cp man/start-squeezelite.1 debian/hifiberry-squeezelite/usr/share/man/man1/

override_dh_auto_clean:
	rm -rf squeezelite/
	find . -name "*.o" -delete 2>/dev/null || true

override_dh_auto_test:
	# Skip tests - requires audio hardware
