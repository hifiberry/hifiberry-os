#!/usr/bin/make -f

%:
	dh $@

override_dh_auto_build:
	# Vue.js application is already built by Docker, verify both locations
	if [ -d debian/webui-dist ]; then \
		echo "Using pre-built Vue.js files from debian/webui-dist"; \
		mkdir -p hbos-ui/dist; \
		cp -r debian/webui-dist/* hbos-ui/dist/; \
	fi
	test -d hbos-ui/dist || (echo "Vue.js build directory not found" && exit 1)
	test -f hbos-ui/dist/index.html || (echo "Vue.js build failed - index.html not found" && exit 1)

override_dh_auto_install:
	# Install the built web application to /usr/share/hifiberry/webui
	mkdir -p debian/hifiberry-webui/usr/share/hifiberry/webui
	cp -r hbos-ui/dist/* debian/hifiberry-webui/usr/share/hifiberry/webui/
	
	# Fix file permissions for web assets
	find debian/hifiberry-webui/usr/share/hifiberry/webui -type f -name "*.ttf" -exec chmod 644 {} \;
	find debian/hifiberry-webui/usr/share/hifiberry/webui -type f -name "*.svg" -exec chmod 644 {} \;
	find debian/hifiberry-webui/usr/share/hifiberry/webui -type f -name "*.ico" -exec chmod 644 {} \;
	find debian/hifiberry-webui/usr/share/hifiberry/webui -type f -name "*.html" -exec chmod 644 {} \;
	find debian/hifiberry-webui/usr/share/hifiberry/webui -type f -name "*.js" -exec chmod 644 {} \;
	find debian/hifiberry-webui/usr/share/hifiberry/webui -type f -name "*.css" -exec chmod 644 {} \;

override_dh_auto_clean:
	# Clean up build artifacts
	cd hbos-ui && rm -rf node_modules dist
	dh_auto_clean
