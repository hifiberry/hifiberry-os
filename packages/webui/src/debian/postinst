#!/bin/bash

set -e

case "$1" in
    configure)
        # $2 contains the old version if this is an upgrade
        if [ -z "$2" ]; then
            echo "Installing HiFiBerry Web UI (fresh install)"
            action="install"
        else
            echo "Upgrading HiFiBerry Web UI from version $2"
            action="upgrade"
        fi
        
        # Create necessary directories
        mkdir -p /var/log/nginx
        
        # Set up HiFiBerry Web UI nginx configuration
        if [ -x /usr/sbin/configure-webui ]; then
            echo "Setting up HiFiBerry Web UI nginx configuration"
            /usr/sbin/configure-webui setup || true
        else
            echo "Warning: configure-webui not found at /usr/sbin/configure-webui"
            echo "Manual setup required: run 'sudo configure-webui setup' to enable the Web UI"
            ls -la /usr/sbin/configure-webui || echo "File does not exist"
        fi
        ;;
    
    abort-upgrade|abort-remove|abort-deconfigure)
        # Nothing to do in these cases
        ;;
    
    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
        ;;
esac

#DEBHELPER#

exit 0
