#!/usr/bin/make -f

export PYBUILD_NAME=xmltodict
export PYBUILD_DIR=xmltodict-source

%:
	dh $@ --with python3 --buildsystem=pybuild

override_dh_auto_clean:
	rm -rf xmltodict-source/
	rm -f *.tar.gz
	find . -name "*.pyc" -delete
	find . -name "__pycache__" -type d -exec rm -rf {} + 2>/dev/null || true

override_dh_auto_configure:
	# Download xmltodict source from PyPI
	if [ ! -d xmltodict-source ]; then \
		if command -v pip3 >/dev/null 2>&1; then \
			pip3 download xmltodict --no-binary :all: --no-deps --dest .; \
		elif command -v pip >/dev/null 2>&1; then \
			pip download xmltodict --no-binary :all: --no-deps --dest .; \
		else \
			wget "https://files.pythonhosted.org/packages/source/x/xmltodict/xmltodict-0.13.0.tar.gz" -O "xmltodict-0.13.0.tar.gz"; \
		fi; \
		TARFILE=$$(ls xmltodict-*.tar.gz | head -n1); \
		tar -xzf "$$TARFILE"; \
		SRCDIR=$$(basename "$$TARFILE" .tar.gz); \
		mv "$$SRCDIR" xmltodict-source; \
	fi

override_dh_auto_build:
	dh_auto_build

override_dh_auto_install:
	dh_auto_install

override_dh_auto_test:
	# Skip tests - no test suite provided
